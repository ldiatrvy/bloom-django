{% extends 'main/layout.html' %}
{% load static %}
{% load catalog_extras %}

{%block title%}{{ bouquet.name }} - Bloom{% endblock %}

{% block content %}
<div class="features">
    <div class="row">
        <a href="{% url 'catalog_flow' %}" class="btn btn-dark" style="width: auto;">
            <i class="fa-solid fa-arrow-left"></i> Вернуться в каталог
        </a>           
    </div>
    <div class="container">
<div id="image-container" class="image-container">
  <img src="{{ bouquet.image.url }}" alt="{{ bouquet.name }}" class="description_img">
  <div class="description_gradient"></div>
</div>
<button id="toggle-image" class="collapse_image">Развернуть</button>

        <h1 class= "col-md-9">{{ bouquet.name }}</h1>
        <p>{{ bouquet.price }} руб.</p>
        <h3>Описание</h3>
        <p>{{ bouquet.description }}</p>
        <h3>Тип упаковки</h3>
        <p>{{ bouquet.get_bouquet_type_display }}</p>
        <h3>Состав</h3>
        <p>{{ bouquet.flowers_sort }}</p>
        {% if user.is_authenticated %}
        {% with quantity=cart_quantities|get_item:bouquet.id %}
        {% if quantity > 0 %}
            <p class="added-to-cart-msg add-to-cart-form">Товар добавлен в корзину</p>
        {% else %}
        <form method="post" action="{% url 'cart:cart_add' bouquet.id %}" class="add-to-cart-form" data-product-id="{{ bouquet.id }}">
            {% csrf_token %}
            <button type="submit" class="settings-btn description_btn"><i class="fa-solid fa-cart-plus"></i> Добавить в корзину</button>
        </form>

        {% endif %}
        {% endwith %}
        {% else %}
        <a href="{% url 'login' %}?next={{ request.path }}" class="btn btn-light">
            <i class="fa-solid fa-cart-plus"></i> Войдите чтобы купить
        </a>
        {% endif %}
    </div>
</div>
<script>
  document.addEventListener('visibilitychange', function() {
    if (!document.hidden) {
      location.reload();
    }
  });
  const button = document.getElementById('toggle-image');
const container = document.getElementById('image-container');

button.addEventListener('click', () => {
  container.classList.toggle('expanded');
  if (container.classList.contains('expanded')) {
    button.textContent = 'Свернуть';
  } else {
    button.textContent = 'Развернуть';
  }
});


</script>

{% endblock %}